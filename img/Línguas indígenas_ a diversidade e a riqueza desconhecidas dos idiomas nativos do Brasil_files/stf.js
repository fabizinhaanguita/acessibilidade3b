var _ain=_ain||{};_ain.widget=_ain.widget||[],_ain.version=25,_ain.E_INV_EL=2,_ain.E_NO_SOC=3,_ain.E_LSTN=4,_ain.E_INCORRECT_OPTION_ACCESS_LEVEL=5,_ain.E_INCORRECT_OPTION_READER_TYPE=6,_ain.errors=[],_ain.DEFAULT_RECOMMENDATION_ELEMENT=".ain-rcm-widget",_ain.CID_KEY="_ain_cid",_ain.CID_TIME=18e5,_ain.UID_KEY="_ain_uid",_ain.UID_TIME=15552e6,_ain.DEFAULT_CANCEL_REQUEST_TIME=2e3,_ain.PAGE_TYPE_ARTICLE="article",_ain.PAGE_TYPE_LANDING="landing",_ain.cancelRequestTime=_ain.cancelRequestTime||_ain.DEFAULT_CANCEL_REQUEST_TIME,_ain.noCookies=_ain.noCookies||!1,_ain.partyId=_ain.partyId||null,_ain.sessionId=_ain.sessionId||null,_ain.config={pv_url:["ingestion.contentinsights.com/p"],at_url:["ingestion.contentinsights.com/a"],cr_url:"cr-seg.contentinsights.com/widget",cr_css:"cr-seg.contentinsights.com/widget/css/main.css",conversion_url:"https://conversions.contentinsights.com/v1/"},_ain.track=function(){if(!_ain.id)return!1;_ain.running=!0,_ain.init()},_ain.stop=function(){_ain.running=!1},_ain.createExpirationDate=function(n){var e=new Date;return e.setTime(e.getTime()+n),e.toGMTString()},_ain.generateCID=function(){return(new Date).getTime()+"."+1e9*Math.random()},_ain.getFromCookie=function(n){var e=n+"=",i=document.cookie.split(";"),t=0;for(t;t<i.length;t+=1){for(var a=i[t];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null},_ain.getCookieId=function(n){if(n!==_ain.CID_KEY&&n!==_ain.UID_KEY)return null;if(!0===_ain.noCookies)return n===_ain.CID_KEY&&_ain.sessionId?_ain.sessionId:n===_ain.UID_KEY&&_ain.partyId?_ain.partyId:_ain.generateCID();var e=_ain.getFromCookie(n);if(null===e){var i=n===_ain.CID_KEY?_ain.CID_TIME:_ain.UID_TIME;if(document.cookie=n+"="+_ain.generateCID()+"; expires="+_ain.createExpirationDate(i)+"; path=/",null===(e=_ain.getFromCookie(n)))return null}else n===_ain.UID_KEY&&(document.cookie=n+"="+e+"; expires="+_ain.createExpirationDate(_ain.UID_TIME)+"; path=/");return e},_ain.sendPostRequest=function(n,e,i,t){var a=new XMLHttpRequest,o=JSON.stringify(e);a.onreadystatechange=function(){4===a.readyState&&(200==a.status||204==a.status?"function"==typeof i&&i(a.responseText,e):"function"==typeof t&&t(a.responseText,e))},a.open("POST",n),a.setRequestHeader("Content-type","application/json"),a.send(o)},_ain.getProtocol=function(){return"https"},_ain.getRecommendationUrl=function(){return _ain.getProtocol()+"://"+_ain.config.cr_url},_ain.getCssUrl=function(){return _ain.getProtocol()+"://"+_ain.config.cr_css},_ain.loadCSS=function(n){var e=document.createElement("link");e.href=n,e.type="text/css",e.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(e)},_ain.loadCustomCSS=function(n){if(n){var e=document.createElement("style");e.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(e)}},_ain.populateWidget=function(n){if(n=n||{},n.element=n.element||_ain.DEFAULT_RECOMMENDATION_ELEMENT,!document.querySelector(n.element))return console.log("Missing widget element!"),!1;if(!_ain.id)return console.log("Missing domain id!"),!1;n.css&&(_ain.loadCustomCSS(n.css),delete n.css),n.domain=_ain.id,n.pid=_ain.postid,n.relatedSections=_ain.sections,n.cookie=_ain.getCookieId(_ain.UID_KEY);var e=function(n,e){document.querySelector(e.element).innerHTML=n},i=function(n,e){console.log("Error on load recommendation!",e,n)},t=_ain.getRecommendationUrl();_ain.sendPostRequest(t,n,e,i)},_ain.precessWidgets=function(){if(_ain.widget&&Array.isArray(_ain.widget)&&_ain.widget.length>0){var n=_ain.getCssUrl();_ain.loadCSS(n);for(var e=0;e<_ain.widget.length;e++)try{_ain.populateWidget(_ain.widget[e])}catch(n){console.log("Error on precessWidgets",n)}}},_ain.getConversionUrl=function(){return _ain.config.conversion_url},_ain.getUID=function(){return _ain.uid||null},_ain.pushConversion=function(n,e,i){var i=i||null,e=e||null,t=_ain.getConversionUrl(),a={domain_id:_ain.id,event:n,ul:_ain.getCookieId(_ain.UID_KEY)};_ain.getUID()&&(a.uid=_ain.getUID()),null!==i&&(a.timestamp=i),null!==e&&(a.data=e);var o=function(n,e){console.log("Conversion successfully sent.",e,n)},r=function(n,e){console.log("Error on push conversion!",e,n)};_ain.sendPostRequest(t,a,o,r)},_ain.init=function(){function n(n,e){if(!1===_ain.running)return!1;for(var i=0;i<n.length;i++)(new Image).src="https://"+n[i]+e}function e(n){return!!(_ain.social&&n in _ain.social)}function i(n){return e(n)?_ain.social[n]:0}function t(n){return void 0!==n?encodeURIComponent(n):""}function a(n,e){if(n in _ain){var i=_ain[n];return-1==e.indexOf(i)?(_ain.errors.push(_ain["E_INCORRECT_OPTION_"+n.toUpperCase()]),""):i}return""}function o(n){return n in _ain?_ain[n]:""}function r(n,e){var i=n.querySelector("link[rel='canonical']"),t=n.querySelector("meta[property='og:url']");return null!==i?i.getAttribute("href"):null!==t?t.getAttribute("content"):e||n.URL}function s(n){return-1==n.indexOf("://")&&(n=m.location.protocol+(0==n.indexOf("//")?"":"//")+n),n}function _(n){if(p(n))return"";for(var e="",i=n.childNodes.length,t=0;t<i;t++){var a=n.childNodes[t];8==a.nodeType||h(a)||(e+=1!=a.nodeType?a.nodeValue:_(a))}return e}function c(n){return n.reduce(function(n,e){return n.getBoundingClientRect().top>e.getBoundingClientRect().top?e:n})}function u(n){return n.reduce(function(n,e){return n.getBoundingClientRect().bottom<e.getBoundingClientRect().bottom?e:n})}function l(n){var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=c(n),t=u(n),a=Math.abs(i.getBoundingClientRect().top-t.getBoundingClientRect().bottom),o=i.getBoundingClientRect().top,r=0;return r=Math.round(100*(e-o)/a),r>100?r=Math.abs(o)>=a?0:100:r<0&&(r=0),r}_ain.selectedText="";var d=["SCRIPT","STYLE","CANVAS","MAP","PICTURE","IMG","VIDEO","OBJECT","SVG","IFRAME"],g=["free","preview","paid"],f=["anonymous","registered","subscribed"];_ain.getWordCount=function(n){var e=parseInt(o("word_count"));return e&&e>0?e:(_ain.selectedText=n.filter(function(n){return!!n}).reduce(function(n,e){return n+=" "+_(e)},""),_ain.selectedText.split(/\s+/).length)};var h=function(n){return-1!==d.indexOf(n.tagName)},p=function(n){var e=o("excludecontent");if(!e)return!1;var i=Element.prototype;return(i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||function(n){return-1!==[].indexOf.call(document.querySelectorAll(n),this)}).call(n,e)};_ain.getMainContentEl=function(n){var e=n,i=[];if(!e){var t={5:'[data-url="'+v.url+'"] .post',1304:"#article .info",1285:".article__content",1298:"#detail",1321:"#d_conmment_holder"};e=t[w]?t[w]:"[data-ci-maincontent]"}if("function"!=typeof document.querySelector)return null;try{i=e.split(",").map(function(n){return document.querySelector(n)}).filter(function(n){return!!n})}catch(n){_ain.errors.push(_ain.E_INV_EL)}return i.length?i:null};var m=document,v=_ain,E=_ain.getCookieId(_ain.CID_KEY),b=_ain.getCookieId(_ain.UID_KEY),C=t(s(v.url||r(m))),w=t(v.id),I=v.postid?"&pid="+t(v.postid):"1208"==w?"&pid="+t(r(m)):"",y=Math.random(),T=t(v.referrer||m.referrer),D="?a="+t(v.authors);if(D+="&b="+T,D+="&c="+t(v.title||m.title),D+="&d="+C,D+="&e="+t(v.sections),D+="&f="+w,D+="&g="+t(v.pubdate),D+="&h="+t(v.tags),D+="&i="+t(v.comments),D+="&j="+t(a("access_level",g)),D+="&k="+t(o("article_type")),D+="&l=",D+="&m="+t(a("reader_type",f)),D+="&ch="+t(v.channel),D+="&n="+t(function(){return _ain.hasOwnProperty("page_type")&&_ain.page_type.toLowerCase()===_ain.PAGE_TYPE_LANDING?_ain.PAGE_TYPE_LANDING:_ain.PAGE_TYPE_ARTICLE}()),D+=I,v._mcel=!1,v._mcelwc=null,null!==E&&null!==b){if(D+="&u="+E,D+="&ul="+b,D+="&x="+y,D+=function(){for(var n="",e=location.search.substr(1).split("&"),i=0;i<e.length;i++)"utm_"==e[i].substring(0,4)&&(n+="&"+e[i]);return n}(),D+=function(){var n="";if("data"in _ain)for(var e in _ain.data){var i=_ain.data[e];i="object"==typeof i?JSON.stringify(i):i,n+="&"+e+"="+t(i)}return n}(),_ain.getUID()&&(D+="&uid="+_ain.getUID()),w){try{!function(n,t){var a=["fb_count","vk_like","vk_share","ok_count","ln_count","pn_count","gp_count"];for(var o in a)e(a[o])&&t("&"+a[o]+"="+i(a[o]))}(t(s(v.social_url||v.url||m.URL)),function(n){D+=n})}catch(n){_ain.errors.push(_ain.E_NO_SOC)}var S=D+"&t=0&err="+t(_ain.errors.join())+"&ver="+_ain.version;n(_ain.config.pv_url,S),v._stid&&clearTimeout(v._stid),v._stid=setTimeout(function(){v._mcelwc=v._mcel?"&wc="+_ain.getWordCount(v._mcel):"";var e=D+v._mcelwc+"&t=1&err="+t(_ain.errors.join())+"&ver="+_ain.version;n(_ain.config.pv_url,e)},1e4)}!function(){window.visibly={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(n){"function"==typeof n&&this.visibleCallbacks.push(n)},onHidden:function(n){"function"==typeof n&&this.hiddenCallbacks.push(n)},getPrefix:function(){if(!this.cachedPrefix)for(var n=0;bb=this.prefixes[n++];)if(bb+this.props[2]in this.q)return this.cachedPrefix=bb,this.cachedPrefix},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(n){"function"==typeof n&&this.genericCallbacks.push(n);var e=this.genericCallbacks.length;if(e)if(this.cachedPrefix)for(;e--;)this.genericCallbacks[e].call(this,this.visibilityState());else for(;e--;)this.genericCallbacks[e].call(this,arguments[0])},isSupported:function(n){return this._getPropName(2)in this.q},_getPropName:function(n){return""==this.cachedPrefix?this.props[n].substring(0,1).toLowerCase()+this.props[n].substring(1):this.cachedPrefix+this.props[n]},_getProp:function(n){return this.q[this._getPropName(n)]},_execute:function(n){if(n){this._callbacks=1==n?this.visibleCallbacks:this.hiddenCallbacks;for(var e=this._callbacks.length;e--;)this._callbacks[e]()}},_visible:function(){window.visibly._execute(1),window.visibly.visibilitychange.call(window.visibly,"visible")},_hidden:function(){window.visibly._execute(2),window.visibly.visibilitychange.call(window.visibly,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{this.isSupported()?this.q.addEventListener(this._getPropName(1),function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1):this.q.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):this.q.attachEvent&&(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",this._hidden))}catch(n){_ain.errors.push(_ain.E_LSTN)}},init:function(){this.getPrefix(),this._listen()}},this.visibly.init()}(),function(){_ain.atparams={d:C,did:w,pid:I,h:E,f:b,x:y},_ain.atobj={secondsBetweenBeats:5.5,activeTimeout:5,sampleRateSeconds:.1,eventNames:["focus","mousedown","mouseup","mousemove","scroll","touchstart","touchenter","keyup","keydown"]};var e=(new Date).getTime();if(_ain.atobj._lastEvent=e,_ain.atobj._lastSample=e,_ain.atobj._engagedMs=0,_ain.atobj._engagedMsTotal=0,_ain.atobj.isEngaged=!0,_ain.atobj.isInteracting=!0,_ain.atobj.focused=!0,_ain.atobj.videoPlaying=!1,_ain.atobj.sequenceNum=1,window.visibly.onVisible(function(){_ain.atobj.focused=!0}),window.visibly.onHidden(function(){_ain.atobj.focused=!1}),void 0===_ain.atregisterEvent){var i=function(n,e){window.addEventListener?window.addEventListener(n,e,!1):document.attachEvent("on"+n,e)};_ain.atregisterEvent=function(){_ain.atobj._lastEvent=(new Date).getTime()};for(var a=0;a<_ain.atobj.eventNames.length;a++)i(_ain.atobj.eventNames[a],_ain.atregisterEvent);_ain.atsample=function(){var n=(new Date).getTime();_ain.atobj.isInteracting=n-_ain.atobj._lastEvent<1e3*_ain.atobj.activeTimeout,_ain.atobj.isEngaged=_ain.atobj.isInteracting&&_ain.atobj.focused||_ain.atobj.videoPlaying,_ain.atobj._engagedMs+=_ain.atobj.isEngaged?n-_ain.atobj._lastSample:0,_ain.atobj._lastSample=n},window.setInterval(_ain.atsample,1e3*_ain.atobj.sampleRateSeconds),_ain.atsendBeat=function(){!1===v._mcel&&(v._mcel=_ain.getMainContentEl(v.maincontent));var e=Math.round(_ain.atobj._engagedMs/1e3);if(e>0&&e<=Math.round(_ain.atobj.secondsBetweenBeats)){_ain.atobj._engagedMsTotal+=e;var i="?d="+_ain.atparams.d+"&f="+_ain.atparams.did+_ain.atparams.pid+"&b="+T+"&u="+_ain.atparams.h+"&ul="+_ain.atparams.f+"&at="+_ain.atobj._engagedMsTotal+"&ar="+e+(v._mcel?"&sp="+l(v._mcel):"")+"&ts="+Math.floor(Date.now()/1e3)+"&seq="+_ain.atobj.sequenceNum+++"&x="+_ain.atparams.x+"&err="+t(_ain.errors.join())+"&ver="+_ain.version+(_ain.getUID()?"&uid="+_ain.getUID():"");n(_ain.config.at_url,i)}_ain.atobj._engagedMs=0},window.setInterval(_ain.atsendBeat,1e3*_ain.atobj.secondsBetweenBeats),i("unload",_ain.atsendBeat)}}()}},_ain.LOADED=!0,"function"==typeof _ain.onload&&_ain.onload(),"undefined"!==_ain.trackauto&&!1===_ain.trackauto||_ain.track(),"undefined"!==_ain.widgetauto&&!1===_ain.widgetauto||_ain.precessWidgets();